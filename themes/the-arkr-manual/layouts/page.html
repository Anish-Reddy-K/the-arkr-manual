{{- define "main" -}}
  {{- $env := getenv "HUGO_ENV" | default "prod" -}}
  {{- $isDev := eq $env "dev" -}}
  
  {{- if and .Draft (not $isDev) -}}
    {{- /* Draft article in production mode - show placeholder */ -}}
    {{- partial "draft-placeholder.html" . -}}
  {{- else -}}
    {{- /* Regular article or draft in dev mode - show full content */ -}}
    <article class="article-content">
      <header class="article-header">
        {{- /* Get all articles across all sections to calculate article number */ -}}
        {{- $allArticles := slice -}}
        {{- range site.Sections.ByWeight -}}
          {{- $pages := .RegularPages -}}
          {{- range $pages.ByWeight -}}
            {{- $allArticles = $allArticles | append . -}}
          {{- end -}}
        {{- end -}}
        {{- /* Find current article index */ -}}
        {{- $articleNumber := 0 -}}
        {{- range $index, $page := $allArticles -}}
          {{- if eq $page.RelPermalink $.RelPermalink -}}
            {{- $articleNumber = add $index 1 -}}
          {{- end -}}
        {{- end -}}
        {{- /* Format article number with leading zeros */ -}}
        {{- $formattedNumber := printf "%03d" $articleNumber -}}
        <p class="article-number">No. {{ $formattedNumber }}</p>
        <h1 class="article-title">{{ .Title }}</h1>
        <p class="article-meta">
          {{- if gt .ReadingTime 0 -}}
            <span class="article-reading-time">{{ .ReadingTime }} min read</span><span class="article-meta-separator">|</span>
          {{- end -}}<span class="article-author">Anish Reddy</span>
        </p>
      </header>
      <div class="article-body">
        {{ .Content }}
      </div>
    </article>
  {{- end -}}
{{- end -}}
