{{- /*
  Breadcrumb Navigation
  Format: < CHAPTER TITLE / ARTICLE TITLE >
  With prev/next navigation buttons
  Buttons are always visible but disabled on homepage and section pages
*/ -}}

{{- /* Get all articles across all sections (including drafts) */ -}}
{{- $allArticles := slice -}}
{{- range site.Sections.ByWeight -}}
  {{- $pages := .RegularPages -}}
  {{- range $pages.ByWeight -}}
    {{- $allArticles = $allArticles | append . -}}
  {{- end -}}
{{- end -}}

{{- /* Initialize prev/next pages as false (disabled) */ -}}
{{- $prevPage := false -}}
{{- $nextPage := false -}}
{{- $breadcrumbText := "" -}}

{{- if .IsPage -}}
  {{- /* Article page - find prev/next articles */ -}}
  {{- $currentPage := . -}}
  {{- $parent := .Parent -}}
  
  {{- /* Find current article index */ -}}
  {{- $currentIndex := -1 -}}
  {{- range $index, $page := $allArticles -}}
    {{- if eq $page.RelPermalink $currentPage.RelPermalink -}}
      {{- $currentIndex = $index -}}
    {{- end -}}
  {{- end -}}
  
  {{- /* Get previous and next articles */ -}}
  {{- if ge $currentIndex 0 -}}
    {{- if gt $currentIndex 0 -}}
      {{- $prevPage = index $allArticles (sub $currentIndex 1) -}}
    {{- end -}}
    {{- if lt $currentIndex (sub (len $allArticles) 1) -}}
      {{- $nextPage = index $allArticles (add $currentIndex 1) -}}
    {{- end -}}
  {{- end -}}
  
  {{- /* Set breadcrumb text for article page - only article title, chapter shown separately */ -}}
  {{- $breadcrumbText = .Title -}}
{{- else if .IsHome -}}
  {{- /* Homepage - buttons disabled */ -}}
  {{- $breadcrumbText = "Home" -}}
{{- else -}}
  {{- /* Section/chapter page - buttons disabled */ -}}
  {{- $breadcrumbText = .Title -}}
{{- end -}}

{{- /* Always render breadcrumb nav with buttons */ -}}
<div class="breadcrumb-nav">
  {{- if $prevPage -}}
    <a href="{{ $prevPage.RelPermalink }}" class="action-button breadcrumb-nav-prev" aria-label="Previous article">
      <span class="material-symbols-outlined">arrow_back</span>
    </a>
  {{- else -}}
    <span class="action-button breadcrumb-nav-prev breadcrumb-nav-disabled" aria-label="No previous article">
      <span class="material-symbols-outlined">arrow_back</span>
    </span>
  {{- end -}}
  
  <span class="breadcrumb-content">
    {{- if .IsPage -}}
      {{- $parent := .Parent -}}
      {{- if and $parent (ne $parent.Kind "home") -}}
        <span class="breadcrumb-chapter">{{ $parent.Title }}</span>
        <span class="breadcrumb-separator">/</span>
      {{- end -}}
    {{- end -}}
    <span class="breadcrumb-item">{{ $breadcrumbText }}</span>
  </span>
  
  {{- if $nextPage -}}
    <a href="{{ $nextPage.RelPermalink }}" class="action-button breadcrumb-nav-next" aria-label="Next article">
      <span class="material-symbols-outlined">arrow_forward</span>
    </a>
  {{- else -}}
    <span class="action-button breadcrumb-nav-next breadcrumb-nav-disabled" aria-label="No next article">
      <span class="material-symbols-outlined">arrow_forward</span>
    </span>
  {{- end -}}
</div>

<script>
(function() {
  'use strict';
  
  // Add click sound to breadcrumb navigation buttons
  function initBreadcrumbSounds() {
    const prevButton = document.querySelector('.breadcrumb-nav-prev:not(.breadcrumb-nav-disabled)');
    const nextButton = document.querySelector('.breadcrumb-nav-next:not(.breadcrumb-nav-disabled)');
    
    if (prevButton && window.playClickSound) {
      prevButton.addEventListener('click', function() {
        window.playClickSound();
      });
    }
    
    if (nextButton && window.playClickSound) {
      nextButton.addEventListener('click', function() {
        window.playClickSound();
      });
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBreadcrumbSounds);
  } else {
    initBreadcrumbSounds();
  }
})();
</script>

